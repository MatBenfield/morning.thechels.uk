on:
  issues:
    types: [labeled]
name: write to file on Label
env:
  workingLabel: '${{github.event.label.name}}'

jobs:

  permission:
    name: permission check
    runs-on: ubuntu-latest
    steps:
    - name: check permission
      id: permission_check
      if: github.actor == github.event.repository.owner.login
      run: echo permission pass
    - name: check permission failed
      if: github.actor != github.event.repository.owner.login
      run: exit 1
    - name: Comment Permission Check Fail
      if: (failure())
      uses: actions/github-script@0.5.0
      with:
        github-token: ${{secrets.GITHUB_TOKEN}}
        script: |
          github.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: ':warning: Attempt to save to '+ workingLabel +' file triggered by @' + context.actor + ' who is NOT the repository owner.'
          })
          github.issues.removeLabel({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            name: '${{ github.event.label.name }}',
          })

  deployment:
    name: Deployment via label
    runs-on: ubuntu-latest
    if: endsWith(github.event.label.name, 'quotes')
    steps:
      - name: Approval granted
        uses: actions/github-script@0.5.0
        with:
          github-token: ${{secrets.GITHUB_TOKEN}}
          script: |
            github.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: 'ðŸ‘‹ @' + context.actor + ', approval granted, creating new item...'
            })
